echo "testing";
: 'have to use the : (the do-nothing command) for comments because this script gets crushed into one line';
:       ;
: MacOS ;
:       ;
if [[ "$OSTYPE" = "darwin"* ]]; then;
    echo "looks like you're on MacOS";
    full_version="$(sw_vers -productVersion)";
    major_version="$(echo "$full_version" | sed -E 's/([0-9]+)\.[0-9]+\.[0-9]+/\1/g')";
    minor_version="$(echo "$full_version" | sed -E 's/[0-9]+\.([0-9]+)\.[0-9]+/\1/g')";
    :                 ; 
    : Big Sur or Newer;
    :                 ;
    if [ "$major_version" = "11" ]; then;
        echo "looks like you're on Big Sur";
        sh <(curl -L https://nixos.org/nix/install) --darwin-use-unencrypted-nix-store-volume
    elif [ "$major_version" -eq "10" ]; then;
        : Catalina ;
        if [ "$minor_version" = "15" ]; then;
            echo "looks like you're on Catalina";
            sh <(curl -L https://nixos.org/nix/install) --darwin-use-unencrypted-nix-store-volume;
        : 'Mojave, High Siera, Siera, and maybe older versions (Yosemite, Mavericks)' ;
        else;
            echo "looks like you're on Mojave, High Siera, Siera, or older";
            curl -L https://nixos.org/nix/install | sh -s -- --daemon;
        fi;
    else;
        echo 'We tried to get you MacOS version by running `sw_vers -productVersion`';
        echo '(which returns '"$full_version"')';
        echo "Either 1. that value is empty 2. You're on an insanely old version 3. You're on a version way way in the future from when this script was made";
    fi;
fi;

:       ;
: Linux ;
:       ;
if [ "$OSTYPE" = "linux-gnu" ]; then;
    echo "looks like you're on Linux";
    sudo apt-get update 2>/dev/null;
    curl -L https://nixos.org/nix/install | bash;
fi;

: manually update the environment ;
source "/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh";
export PATH="$PATH:/nix/var/nix/profiles/default/bin/";
echo "";
echo "If there were no errors above, nix should now be installed!";
echo ""